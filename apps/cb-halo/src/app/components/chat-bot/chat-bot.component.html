<div class="chatbot-container">
  <div class="chatbot-header">
    <div class="chatbot-avatar">
      @if (chatbotImageUrl()) {
        <img [src]="chatbotImageUrl()" alt="Chatbot Avatar" class="avatar-image" />
      } @else {
        <div class="avatar-icon">AI</div>
      }
    </div>
    <div class="chatbot-info">

      <h2>AI Assistant {{ companyId() }}
      </h2>
      <div class="status-indicator">
        <span class="status-dot"></span>
        <span class="status-text">Online</span>
      </div>
    </div>
    <div class="chatbot-actions">
      <button
        class="reset-button"
        (click)="resetConversation()"
        title="Reiniciar conversaciÃ³n"
        type="button">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="23 4 23 10 17 10"></polyline>
          <polyline points="1 20 1 14 7 14"></polyline>
          <path d="m3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
        </svg>
      </button>
    </div>
  </div>

  <div class="chat-messages">
    @for (message of messages; track message) {
      <div
        [ngClass]="{'message': true, 'user-message': message.sender === 'user', 'ai-message': message.sender === 'ai'}">
        <div class="message-content">
          <p>{{ message.content }}</p>
        </div>
        <div class="message-timestamp">
          {{ message.timestamp | date:'shortTime' }}
        </div>
      </div>
    }

    @if (isTyping()) {
      <div class="typing-indicator">
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
      </div>
    }
  </div>

  <div class="chat-input-container">
    <input
      type="text"
      [formControl]="formControl"
      placeholder="Type your message here..."
      (keyup.enter)="sendMessage()"
      class="chat-input"
    />
    <button
      class="send-button"
      [disabled]="!formControl?.value || formControl?.invalid"
      (click)="sendMessage()"
    >
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
           stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="22" y1="2" x2="11" y2="13"></line>
        <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
      </svg>
    </button>
  </div>
</div>
