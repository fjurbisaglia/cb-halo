<div class="settings-container">
  <div class="settings-header">
    <h1>{{ isFirstTime() ? 'Configure Settings' : 'Update Settings' }}</h1>
    <p class="settings-description">
      {{ isFirstTime() ? 'Set up your application settings for the first time.' : 'Modify your application settings.' }}
    </p>
  </div>

  <div class="settings-form-container">
    <form [formGroup]="settingsForm" (ngSubmit)="onSubmit()" class="settings-form">

      <!-- Company Information Section -->
      <div class="form-section">
        <h2>Company Information</h2>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Company Name</mat-label>
          <input matInput formControlName="companyName" placeholder="Enter your company name">
          <mat-error>{{ getFieldError('companyName') }}</mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Company Slogan</mat-label>
          <input matInput formControlName="companySlogan" placeholder="Enter your company slogan">
          <mat-error>{{ getFieldError('companySlogan') }}</mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Company Industry</mat-label>
          <input matInput formControlName="companyIndustry" placeholder="e.g., Technology, Healthcare, Finance">
          <mat-error>{{ getFieldError('companyIndustry') }}</mat-error>
        </mat-form-field>
      </div>

      <!-- Bot Configuration Section -->
      <div class="form-section">
        <h2>Bot Configuration</h2>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Bot Name</mat-label>
          <input matInput formControlName="botName" placeholder="Enter your bot's name">
          <mat-error>{{ getFieldError('botName') }}</mat-error>
        </mat-form-field>

        <div class="temperature-field">
          <label class="temperature-label">Temperature (0-1)</label>
          <p class="temperature-description">Controls the randomness of the bot's responses. Lower values make responses more focused and deterministic.</p>
          <mat-slider
            formControlName="temperature"
            min="0"
            max="1"
            step="0.1"
            showTickMarks
            class="temperature-slider">
            <input matSliderThumb>
          </mat-slider>
          <div class="temperature-value">
            Current value: {{ settingsForm.get('temperature')?.value | number:'1.1-1' }}
          </div>
          <div class="temperature-error" *ngIf="getFieldError('temperature')">
            {{ getFieldError('temperature') }}
          </div>
        </div>
      </div>

      <!-- Tone Settings Section -->
      <div class="form-section">
        <h2>Communication Tone</h2>
        <p class="section-description">Define the tone characteristics for your bot's communication style.</p>

        <div class="tone-chips-container" formArrayName="tone">
          <div
            *ngFor="let toneControl of toneFormArray.controls; let i = index"
            class="tone-chip-item">

            <mat-form-field appearance="outline" class="tone-input">
              <mat-label>Tone {{ i + 1 }}</mat-label>
              <input matInput [formControlName]="i" placeholder="e.g., Professional, Friendly, Helpful">
              <mat-error>{{ getToneError(i) }}</mat-error>
            </mat-form-field>

            <button
              type="button"
              mat-icon-button
              color="warn"
              (click)="removeToneChip(i)"
              [disabled]="toneFormArray.length <= 1"
              class="remove-tone-btn">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        </div>

        <button
          type="button"
          mat-stroked-button
          color="primary"
          (click)="addToneChip()"
          class="add-tone-btn">
          <mat-icon>add</mat-icon>
          Add Tone
        </button>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <button
          type="submit"
          mat-raised-button
          color="primary"
          [disabled]="isLoading() || settingsForm.invalid"
          class="save-btn">

          @if (isLoading()) {
            <mat-spinner diameter="20" class="inline-spinner"></mat-spinner>
            Saving...
          } @else {
            <mat-icon>save</mat-icon>
            {{ isFirstTime() ? 'Create Settings' : 'Update Settings' }}
          }
        </button>
      </div>
    </form>
  </div>

  <!-- Loading Overlay -->
  @if (isLoading()) {
    <div class="loading-overlay">
      <mat-spinner diameter="50"></mat-spinner>
      <p>{{ isFirstTime() ? 'Creating settings...' : 'Updating settings...' }}</p>
    </div>
  }
</div>
